From 537f3cf043ca57bcefd57a0100c2165f63fa0dd5 Mon Sep 17 00:00:00 2001
From: Wang Shilong <wangshilong1991@gmail.com>
Date: Mon, 16 Mar 2015 17:09:25 -0400
Subject: [PATCH] mv xattr macros into btrfs

---
 fs/btrfs/extent_io.c    | 1 +
 fs/btrfs/ordered-data.c | 1 +
 fs/btrfs/xattr.h        | 3 +++
 3 files changed, 5 insertions(+)

diff --git a/fs/btrfs/extent_io.c b/fs/btrfs/extent_io.c
index 55c805e..969b6dc 100644
--- a/fs/btrfs/extent_io.c
+++ b/fs/btrfs/extent_io.c
@@ -3453,6 +3453,7 @@ static noinline_for_stack int __extent_writepage_io(struct inode *inode,
 			update_nr_written(page, wbc, nr_written);
 			if (!keep_page)
 				unlock_page(page);
+			printk(KERN_INFO "__extent_writepage_io we are not well prepared: %d\n", ret);
 			ret = 1;
 			goto done_unlocked;
 		}
diff --git a/fs/btrfs/ordered-data.c b/fs/btrfs/ordered-data.c
index 157cc54..62a61d2 100644
--- a/fs/btrfs/ordered-data.c
+++ b/fs/btrfs/ordered-data.c
@@ -769,6 +769,7 @@ int btrfs_wait_ordered_range(struct inode *inode, u64 start, u64 len)
 	}
 	return ret;
 }
+EXPORT_SYMBOL(btrfs_wait_ordered_range);
 
 /*
  * find an ordered extent corresponding to file_offset.  return NULL if
diff --git a/fs/btrfs/xattr.h b/fs/btrfs/xattr.h
index b3cc803..464fd67 100644
--- a/fs/btrfs/xattr.h
+++ b/fs/btrfs/xattr.h
@@ -21,6 +21,9 @@
 
 #include <linux/xattr.h>
 
+#define XATTR_BTRFS_PREFIX "btrfs."
+#define XATTR_BTRFS_PREFIX_LEN (sizeof(XATTR_BTRFS_PREFIX) - 1)
+
 extern const struct xattr_handler btrfs_xattr_acl_access_handler;
 extern const struct xattr_handler btrfs_xattr_acl_default_handler;
 extern const struct xattr_handler *btrfs_xattr_handlers[];
-- 
1.8.3.1

